<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Dashboard | Ash Mobile's</title>
    <link rel="stylesheet" href="../css/dashboard.css">
</head>
<body>

<!-- üîê AUTH PROTECTION -->
<script>
    // If token not found, redirect to login
    if (!localStorage.getItem("token") || localStorage.getItem("role") !== "customer") {
        window.location.href = "../customer-login.html";
    }
</script>

<!-- üîπ NAVBAR -->
<div class="navbar">
    <h2>Ash Mobile's</h2>
    <button class="dark-mode-toggle" onclick="toggleDarkMode()" id="darkModeToggle" title="Toggle Dark Mode">üåô</button>
    <div class="shop-status-badge" id="shopStatusBadge">
        <span class="status-indicator">üü¢</span>
        <span class="status-label">Shop is Live</span>
    </div>
    <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
    <div class="nav-menu" id="navMenu">
        <a href="mobiles.html">Mobiles</a>
        <a href="orders.html">My Orders</a>
        <button onclick="logout()">Logout</button>
    </div>
</div>

<!-- üîπ MAIN CONTENT -->
<div class="container">
    <h2>Welcome, <span id="userName">Customer</span> üëã</h2>
    <p>Browse second-hand mobiles and place your orders.</p>

    <div class="cards">
        <div class="card">
            <h3>Browse Mobiles</h3>
            <p>View all available second-hand mobiles.</p>
            <a href="mobiles.html">View Mobiles</a>
        </div>

        <div class="card">
            <h3>My Orders</h3>
            <p>Track your orders and delivery status.</p>
            <a href="orders.html">View Orders</a>
        </div>
    </div>

    <!-- ÔøΩ OFFERS SECTION -->
    <div class="offers-section">
        <h2>üéÅ Current Offers</h2>
        <div class="offers-grid" id="offersGrid">
            <p>Loading offers...</p>
        </div>
    </div>

    <!-- ÔøΩüè™ STORE INFORMATION SECTION -->
    <div class="store-section">
        
        <!-- About Our Store -->
        <div class="store-info-grid">
            <div class="card store-card">
                <h3>üìç About Our Store</h3>
                <div id="aboutStoreDetails">
                    <p>Loading store information...</p>
                </div>
            </div>

            <!-- Shop Hours -->
            <div class="card store-card hours-card">
                <h3>üïê Shop Hours</h3>
                <div class="hours-content">
                    <div class="hours-item">
                        <span class="day">üìÖ Weekdays</span>
                        <span class="status open" id="weekdaysStatus">Open</span>
                    </div>
                    <div class="hours-item">
                        <span class="day">üìÖ Saturday</span>
                        <span class="status open" id="saturdayStatus">Open</span>
                    </div>
                    <div class="hours-item">
                        <span class="day">üìÖ Sunday</span>
                        <span class="status closed" id="sundayStatus">Closed</span>
                    </div>
                </div>
                <p class="note-text" id="hoursNote">Weekdays: Monday - Friday</p>
            </div>

            <!-- Store Location Map -->
            <div class="card store-card">
                <h3>üó∫Ô∏è Store Location</h3>
                <iframe 
                    id="storeMap"
                    width="100%" 
                    height="250" 
                    style="border:none;border-radius:6px;" 
                    allowfullscreen="" 
                    loading="lazy" 
                    referrerpolicy="no-referrer-when-downgrade">
                </iframe>
            </div>

            <!-- Payment Details -->
            <div class="card store-card">
                <h3>üí≥ Payment Details</h3>
                <div id="paymentDetails">
                    <p>Loading payment information...</p>
                </div>
            </div>

            <!-- Shipping Details -->
            <div class="card store-card">
                <h3>üì¶ Shipping Details</h3>
                <p><strong>Courier Service:</strong></p>
                <p id="courierService" style="margin:8px 0;">Loading...</p>
                <p class="note-text">We provide fast and secure shipping to all locations.</p>
            </div>

            <!-- Testing Warranty -->
            <div class="card store-card warranty-card">
                <h3>‚úÖ Testing Warranty</h3>
                <div id="warrantyDetails">
                    <p>Loading warranty information...</p>
                </div>
            </div>

            <!-- Social Media & Contact -->
            <div class="card store-card">
                <h3>üì± Connect With Us</h3>
                <div class="social-buttons">
                    <button class="social-btn whatsapp-btn" onclick="openWhatsApp()" title="Chat on WhatsApp">
                        <span>üí¨</span> Direct Message
                    </button>
                    <button class="social-btn whatsapp-group-btn" onclick="openWhatsAppGroup()" title="Join WhatsApp Group">
                        <span>üë•</span> Group Link
                    </button>
                    <button class="social-btn instagram-btn" onclick="openInstagram()" title="Follow on Instagram">
                        <span>üì∑</span> Instagram
                    </button>
                </div>
                <p class="note-text">Quick support & latest updates</p>
            </div>
        </div>
    </div>
</div>

<!-- üîπ LOGOUT SCRIPT -->
<script>
function logout() {
    localStorage.clear();
    window.location.href = "../customer-login.html";
}

function toggleMenu() {
    const navMenu = document.getElementById('navMenu');
    navMenu.classList.toggle('active');
}

// Close menu when clicking outside
document.addEventListener('click', function(event) {
    const navbar = document.querySelector('.navbar');
    const navMenu = document.getElementById('navMenu');
    const toggle = document.querySelector('.menu-toggle');
    
    if (navbar && !navbar.contains(event.target)) {
        navMenu.classList.remove('active');
    }
});

// Display user name on load
document.addEventListener('DOMContentLoaded', function() {
    const userName = localStorage.getItem('userName') || 'Customer';
    document.getElementById('userName').textContent = userName;
    
    // Update shop status on load and every 2 seconds
    updateShopStatusBadge();
    setInterval(updateShopStatusBadge, 2000);
});

async function updateShopStatusBadge() {
    try {
        const response = await fetch('https://ash-mobiles-backend.onrender.com/api/shop/status');
        const data = await response.json();
        const shopStatus = data.status === 'open' ? 'open' : 'closed';
        const badge = document.getElementById('shopStatusBadge');
        
        if (shopStatus === 'open') {
            badge.innerHTML = '<span class="status-indicator">üü¢</span><span class="status-label">Shop is Live</span>';
            badge.classList.add('status-open');
            badge.classList.remove('status-closed');
        } else {
            badge.innerHTML = '<span class="status-indicator">üî¥</span><span class="status-label">Shop is Closed</span>';
            badge.classList.add('status-closed');
            badge.classList.remove('status-open');
        }
    } catch (error) {
        console.error('Error fetching shop status:', error);
        // Fallback to closed if API fails
        const badge = document.getElementById('shopStatusBadge');
        badge.innerHTML = '<span class="status-indicator">üî¥</span><span class="status-label">Shop is Closed</span>';
        badge.classList.add('status-closed');
        badge.classList.remove('status-open');
    }
}

function displayOffers() {
    const offers = getOffers();
    const offersGrid = document.getElementById('offersGrid');
    
    if (offers.length === 0) {
        offersGrid.innerHTML = '<p>No offers available at this moment.</p>';
        return;
    }
    
    offersGrid.innerHTML = offers.map(offer => `
        <div class="offer-card">
            <div class="offer-icon">${offer.icon}</div>
            <h3>${offer.title}</h3>
            <p>${offer.description}</p>
            <div class="offer-badge">${offer.discount} OFF</div>
        </div>
    `).join('');
}
</script>

<!-- üéÅ OFFERS SCRIPT -->
<script src="../js/offers-config.js"></script>
<script>
    // Display offers on page load and refresh every 3 seconds for real-time updates
    document.addEventListener('DOMContentLoaded', function() {
        displayOffers();
        // Refresh offers every 3 seconds to get real-time updates when owner changes offers
        setInterval(displayOffers, 3000);
    });
    
    // Update displayOffers to be async and fetch from DB
    async function displayOffers() {
        const offers = await getOffers();
        const offersGrid = document.getElementById('offersGrid');
        
        if (offers.length === 0) {
            offersGrid.innerHTML = '<p>No offers available at this moment.</p>';
            return;
        }
        
        offersGrid.innerHTML = offers.map(offer => `
            <div class="offer-card">
                <div class="offer-icon">${offer.icon}</div>
                <h3>${offer.title}</h3>
                <p>${offer.description}</p>
                <div class="offer-badge">${offer.discount} OFF</div>
            </div>
        `).join('');
    }
</script>

<!-- üîπ STORE INFO SCRIPTS -->
<script src="../js/store-config.js"></script>
<script src="../js/store-info.js"></script>

<!-- üåô DARK MODE SCRIPT -->
<script>
// Initialize dark mode from localStorage
function initDarkMode() {
    const isDarkMode = localStorage.getItem('darkMode') === 'true';
    const toggle = document.getElementById('darkModeToggle');
    
    if (isDarkMode) {
        document.body.classList.add('dark-mode');
        if (toggle) toggle.classList.add('active');
        if (toggle) toggle.textContent = '‚òÄÔ∏è';
    } else {
        document.body.classList.remove('dark-mode');
        if (toggle) toggle.classList.remove('active');
        if (toggle) toggle.textContent = 'üåô';
    }
}

// Toggle dark mode
function toggleDarkMode() {
    const isDarkMode = document.body.classList.toggle('dark-mode');
    const toggle = document.getElementById('darkModeToggle');
    
    localStorage.setItem('darkMode', isDarkMode);
    
    if (isDarkMode) {
        if (toggle) toggle.classList.add('active');
        if (toggle) toggle.textContent = '‚òÄÔ∏è';
    } else {
        if (toggle) toggle.classList.remove('active');
        if (toggle) toggle.textContent = 'üåô';
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    initDarkMode();
});
</script>

</body>
</html>
